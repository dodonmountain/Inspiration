{% extends 'base.html' %}
{% block css %}
<style>
    html {
        height: 100vh;
        overflow: hidden;
    }

    body {
        background-color: #1f1f1f;
        height: 100vh
    }

    .starField {
        background: transparent;
        bottom: 0;
        padding: 0;
        margin: 0;
        color: transparent;
        font-size: 9vw;
        text-shadow: white;
        position: fixed;
    }

    .twinkle {
        animation: twin 3s;
        shadow: 5px 5px white;
    }

    @keyframes twin {
        from {
            color: orange;
            transform: rotate(0deg);
        }

        to {
            color: transparent;
            transform: rotate(200deg);
        }
    }

    :root {

        /* Tile Dimensions */
        --carousel-tile-spacing: 10px;
        --carousel-tile-width: 5rem;
        --carousel-tile-height: calc(var(--carousel-tile-width) / (16 / 9));

        /* Growth Factor */
        --carousel-growth-factor: 1.8;

        /* Fade to Opacity */
        --carousel-fade-opacity: 0.25;
        --carousel-normal-opacity: 1;

        /* Automatic Offsets - DO NOT ALTER */
        --carousel-offset-left: calc(-1 * (var(--carousel-tile-width) * (var(--carousel-growth-factor) - 1) / 2));
        --carousel-offset-right: calc(var(--carousel-tile-width) * (var(--carousel-growth-factor) - 1));

        /* Transition Speeds */
        --carousel-transition-1: 1s;
        --carousel-transition-2: 0.5s;
        --carousel-transition-3: 0.3s;

    }

    /* Carousel Container */
    .carousel {
        overflow: hidden;
        white-space: nowrap;
        height: 100vh;
    }

    /* Carousel Row */
    .carousel-row {
        white-space: nowrap;
        margin-top: 0rem;
        margin-left: calc((var(--carousel-tile-width) * (var(--carousel-growth-factor) - 1)) / 2);
        margin-right: calc((var(--carousel-tile-width) * (var(--carousel-growth-factor) - 1)) / 2);
        transition: var(--carousel-transition-2);
    }

    .carousel-card {
        width: 5rem;
    }

    /* Content Tile */
    .carousel-tile {
        position: relative;
        display: inline-block;
        margin-left: 2rem;
        width: 20rem;
        height: var(--carousel-tile-height);
        margin-right: 17rem;
        transition: var(--carousel-transition-2);
        -webkit-transform-origin: center left;
        transform-origin: center left;
        cursor: pointer;
        cursor: hand;
    }

    /* Add Extra Margin to Last Carousel Tile */
    .carousel-tile:last-of-type {
        margin-right: calc(var(--carousel-tile-width)/2);
    }

    /* Ensure All Elements Inside Tile are Block */
    .carousel-tile * {
        width: 16vw;
    }

    .carousel-tile>a>img {
        border-radius: 10%;
    }

    /* Carousel Row on Hover */
    .carousel-row-hover {
        -webkit-transform: translate3d(var(--carousel-offset-left), 0, 0);
        transform: translate3d(var(--carousel-offset-left), 0, 0);
    }

    /* Content Tile on Carousel Row Hover */
    .carousel-row-hover .carousel-tile {
        opacity: var(--carousel-fade-opacity);
    }

    /* Content Tile on Hover on Carousel Row Hover */
    .carousel-row-hover .carousel-tile-hover {
        -webkit-transform: scale(var(--carousel-growth-factor));
        transform: scale(var(--carousel-growth-factor));
        opacity: var(--carousel-normal-opacity);
    }

    .car-body {
        font-family: 'Arial Narrow Bold', sans-serif;
    }

    #overlay {
        position: fixed;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 2;
    }

    #rateLeft {
        margin: 0 30rem;
        background-color: rgba(0, 0, 0, 0.3)
    }
    .scoreForNow{
        font-size: 14rem;
        color: white;
        font-family: 'Impact';
        transition: 200ms;
    }
    .scoreFormer {
        transform: translateX(-2.3em) translateY(-0.4em) rotate(35deg);
        position:fixed;
    }
    .progress {
        height: 2rem;
        opacity: 0.8;
    }
    .progress-bar {
        transition: 1000ms;
        height: 2rem;
        background-color: #FAD961;
        background-image: linear-gradient(90deg, #FAD961 0%, #F76B1C 100%);
    }
    .RaterDescription {
        border-radius: 20px 20px;
        border: 4px dotted white;
        background: rgba(200,200,200,0.4);
        padding: 2rem;
    }
</style>
{% endblock css %}
{% block body %}
<div id="overlay" class="container-fluid">
    <h1 class="text-center text-white" id="rateLeft">15</h1>
    <div class="progress">
        <div class="progress-bar" id="timer" role="progressbar" aria-valuenow="333" aria-valuemin="0" aria-valuemax="333"></div>
    </div>
		<div class="row">
			<div class="col-4"></div>
			<div class="col-4 text-center">
				<h1 class="mt-5 text-white">SCORE</h1>
				<h1 class="scoreForNow">RATE NOW</h1>
			</div>
			<div class="col-4 text-white mt-5 RaterDescription text-center pt-5">
            <h2>당신의 취향을 '빠르게' 알려주세요.</h2>
            <h3><i class="fa fa-keyboard-o fa-4x mr-3"></i>숫자패드를 이용해주세요</h3>

            <h3>1~9번은 1~9점, 0번은 10점입니다</h3>

            </div>
		</div>
</div>
<div id='car' class="carousel fadein mt-3 mb-0">
    <div class="carousel-row carousel-row-hover">
        {% for movie in movies %}
        <div class="carousel-tile">
            <a href="{% url 'movies:detail' movie.id %}"><img src="https://image.tmdb.org/t/p/w500{{ movie.poster_path }}" style="height: 40vh;"></a>
            <div class="text-white text-center mt-3 overflow-hidden">
                <h3 class="car-body">{{ movie.title }}</h3>
                <i class="fa fa-clock-o">{{ movie.runtime }}분</i>
                <br>
                {% for genre in movie.genres.all %}
                <span style="font-family: sans serif" class="p-1 ">| {{ genre.name }} |</span>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
<div class="starField container-fluid mb-0 overflow-hidden">
    <div class="row justify-content-lg-around m-0">
        <div id="star1">★</div>
        <div id="star2">★</div>
        <div id="star3">★</div>
        <div id="star4">★</div>
        <div id="star5">★</div>
        <div id="star6">★</div>
        <div id="star7">★</div>
        <div id="star8">★</div>
        <div id="star9">★</div>
        <div id="star10">★</div>
    </div>
</div>
{% endblock body %}

{% block script %}
<script>
    const star1 = document.getElementById('star1')
    const star2 = document.getElementById('star2')
    const star3 = document.getElementById('star3')
    const star4 = document.getElementById('star4')
    const star5 = document.getElementById('star5')
    const star6 = document.getElementById('star6')
    const star7 = document.getElementById('star7')
    const star8 = document.getElementById('star8')
    const star9 = document.getElementById('star9')
    const star10 = document.getElementById('star10')
    let isStopped = false;
    const Stars = [star1, star2, star3, star4, star5, star6, star7, star8, star9, star10]
    let pressedScore;
    pressedScore = 0
    let passThis = false;
    let movieNow = 1;
    let target = document.querySelectorAll('.carousel-tile')[movieNow]
		let colors = ['royalblue', 'orange', 'darkviolet', 'hotpink', 'tomato','crimson',  'seagreen']
		let random_color = colors[Math.floor(Math.random() * colors.length)];
    function sideScroll(direction, speed, distance, step) {
        scrollAmount = 0;
        var slideTimer = setInterval(function() {
            if (direction == 'left') {
                car.scrollLeft -= step;
            } else {
                car.scrollLeft += step;
            }
            scrollAmount += step;
            if (scrollAmount >= distance) {
                window.clearInterval(slideTimer);
            }
        }, speed);
    }
    const rLeft = document.getElementById('rateLeft')
    let former;
    window.onkeydown = function() {
        if (!isStopped)
        {
        pressedScore = 0
        if (event.key == '1') {
            pressedScore = 1
        } else if (event.key == '2') {
            pressedScore = 2
        } else if (event.key == '3') {
            pressedScore = 3
        } else if (event.key == '4') {
            pressedScore = 4
        } else if (event.key == '5') {
            pressedScore = 5
        } else if (event.key == '6') {
            pressedScore = 6
        } else if (event.key == '7') {
            pressedScore = 7
        } else if (event.key == '8') {
            pressedScore = 8
        } else if (event.key == '9') {
            pressedScore = 9
        } else if (event.key == '0') {
            pressedScore = 10
        } else if (event.keyCode == 32) {
            passThis = true
        }
        if (0 < pressedScore && pressedScore < 11) {
            for (let i = 0; i < pressedScore; i++) {
                setTimeout(() => {
                    Stars[i].classList.add('twinkle')
                }, 250)
                Stars[i].classList.remove('twinkle')
            };
            car.scrollLeft += 629.2
            target = document.querySelectorAll('.carousel-tile')[movieNow]
            target.classList.remove('carousel-tile-hover')
            movieNow += 1
            document.querySelectorAll('.carousel-tile')[movieNow].classList.add('carousel-tile-hover')
            if (parseInt(rLeft.innerText) <= 1) {
                document.querySelector('.scoreForNow').innerText = 'THANK YOU'
                let thx = document.querySelector('.scoreForNow').innerText = 'THANK YOU'.cloneNode(true)
                former.parentNode.appendChild(thx)
                isStopped = true
                car.hidden = true
            }
            rLeft.innerText -= 1
            former = document.querySelector('.scoreForNow')
            random_color = colors[Math.floor(Math.random() * colors.length)];
            document.querySelector('.scoreForNow').style.color = random_color
            former.innerText = pressedScore
            let cln = former.cloneNode(true)
            former.parentNode.appendChild(cln)
            former.classList.add('scoreFormer')
            widthNow = 100
            clearInterval()
            setTimeout(() => {
                former.hidden = true
                former.classList.remove('scoreForNow')
            }, 300);
        };
        }
    }
    const timer = document.getElementById('timer')
    let widthNow;
    setInterval(() => {
        timer.style.width = widthNow + "%" 
        if (widthNow < 0) {
            stopAll()
            document.querySelector('.scoreForNow').innerText = 'TRY AGAIN'

        }
    }, 1000);
    setInterval(() => {
        widthNow -= 1
        console.log(widthNow)
    }, 150);
    function stopAll() {
        isStopped = true
        timer.hidden = true
        timer.parentElement.hidden = true
    }
</script>
{% endblock script %}