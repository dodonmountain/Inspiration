{% extends 'base.html' %}
{% load static %}
{% block css %}
<link rel="stylesheet" href="{% static 'indexes/css/index.css' %}">
<style>
.pagebutton {
    margin-top:15vh;
    margin-left:40vw;
    margin-right:40vw;
}
</style>
{% endblock %}

{% block body %}
<h1 class="opener">INSPIRATION</h1>
{% include '_navbar.html' %}
{% if user.is_authenticated %}
<div id='car' class="carousel fadein mt-3 mb-0">
    <h2 class="queIndicator"><small>평점 순 영화 추천</small></h2>
    <div id="ifFirstTime">
    <p class="d-flex mt-5 ml-4 position-fixed"><small class="mt-4 text-white-50">만약 영감이 처음이시라면? </small> <a class="text-white ml-2 mt-4" href="/rater/">초기평가 하러가기</a></p>
    </div>

    <div class="mt-5 pgnat">

        <ul class="pagination justify-content-center">

            <li class="page-item disabled">
                <a class="page-link" href="/index/" tabindex="-1" aria-disabled="true">평점순</a>
            </li>

            <li class="page-item">
                <a style="color:orange" class="page-link" href="/index/my">추천순</a>
            </li>
        </ul>

    </div>



    <div class="carousel-row">
        {% for movie in movies %}
        <div class="carousel-tile">
            <a href="{% url 'movies:detail' movie.id %}" class="text-decoration-none">
                <h3 class="position-absolute"><span id="avgscore">{{ movie.avg }}</span> 점</h3>
                <img src="https://image.tmdb.org/t/p/w500{{ movie.poster_path }}" style="height: 40vh;">

            </a>
            <div class="text-white text-center mt-3 p-0">
                <h3 class="car-body overflow-hidden">{{ movie.title }}</h3>
                <i class="fa fa-clock-o">{{ movie.runtime }}분</i>
                <br>
                <div class="row m-0 p-3">
                {% for genre in movie.genres.all %}
                    <p class="col badge badge-info ">{{ genre.name }}</p>
                {% endfor %}
                </div>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div style="margin-top: 15%;">
            <h1 class="display-1 font-weight-bolder text-center mt-5 text-white-50">
                로그인해서 회원님만을 위한 맞춤 리스트를 받아보세요.
            </h1>
        </div>
        {% endif %}
    </div>
</div>


{% endblock %}

{% block script %}
<script>
    const avgscore = document.querySelectorAll('#avgscore')
    const lst = document.querySelector('#car')
    const app = document.querySelector('#app')
    const navbar = document.querySelector('#navBar')
    const rand = document.querySelectorAll('.rand')
    const tiles = document.querySelectorAll('.carousel-tile')
    const tags = document.querySelectorAll('.badge-info')
    let last_known_scroll_position = 0;
    let flag = false
    const colors = ['primary', 'danger', 'success', 'warning', 'info', 'light']
    for (i=0;i<avgscore.length;i++) {
        var avg = avgscore[i].innerText * 1
        avgscore[i].innerText = avg.toFixed(2);
    }
    window.onload = function() {
        navbar.hidden = true
        lst.hidden = true
        setTimeout(function() {
            navbar.classList.add('fadein')
            lst.hidden = false
            navbar.hidden = false
            for (i=0; i<tags.length; i++) {
                tags[i].classList.replace('badge-info', 'badge-' + colors[Math.floor(Math.random() * colors.length)])
            }
        }, 50);
    }


    function sideScroll(direction, speed, distance, step) {
        scrollAmount = 0;
        var slideTimer = setInterval(function() {
            if (direction == 'left') {
                lst.scrollLeft -= step;
            } else {
                lst.scrollLeft += step;
            }
            scrollAmount += step;
            if (scrollAmount >= distance) {
                window.clearInterval(slideTimer);
            }
        }, speed);
    }
    window.addEventListener('wheel', function(e) {
        if (e.deltaY > 0) {
            sideScroll('right', 3, 340, 5)
        } else {
            sideScroll('left', 3, 340, 5)
        }
    })
</script>

{% endblock %}